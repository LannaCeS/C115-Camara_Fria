<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Simulador em Tempo Real</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">
<div class="container mt-4">

    <h2 class="text-center mb-4">Simulador de Câmara Fria — Tempo Real</h2>

    <div class="card shadow p-4">
        <form id="form-cenario" method="POST" action="/set_cenario">
            <label class="form-label fw-bold">Selecione o cenário:</label>

            <select class="form-select" name="cenario">
                <option value="congelados">Congelados (-23°C)</option>
                <option value="resfriados">Resfriados (2°C)</option>
                <option value="congelados_porta">Congelados — Porta Aberta</option>
                <option value="resfriados_porta">Resfriados — Porta Aberta</option>
            </select>

            <button class="btn btn-primary mt-3 w-100">Iniciar</button>
        </form>
    </div>

    <div class="card shadow p-4 mt-4">
        <h4 class="mb-3">Leituras em Tempo Real</h4>

        <p><strong>Temperatura:</strong> <span id="temp">--</span> °C</p>
        <p><strong>Resistência PT100:</strong> <span id="res">--</span> Ω</p>
        <p><strong>Umidade:</strong> <span id="hum">--</span> %</p>
    </div>

</div>

<script>
    // Ativa SSE quando carregar
    const evtSource = new EventSource("/stream");

    evtSource.onmessage = function(event) {
        if (!event.data) return;
        const dados = JSON.parse(event.data);

        document.getElementById("temp").textContent = dados.temperatura;
        document.getElementById("res").textContent = dados.resistencia;
        document.getElementById("hum").textContent = dados.umidade;
    };

    // Envia o cenário sem recarregar a página
    document.getElementById("form-cenario").onsubmit = function(e) {
        e.preventDefault();
        fetch("/set_cenario", {
            method: "POST",
            body: new FormData(this)
        });
    };
</script>

</body>
</html>
